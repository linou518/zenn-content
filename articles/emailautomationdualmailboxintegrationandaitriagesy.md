---
title: "メール自動化：デュアルメールボックス接続とAIトリアージシステム"
emoji: "📝"
type: "tech"
topics: ["OpenClaw", "AI"]
published: true
---


メールはAI Agent時代でも不可欠な情報入口。デュアルメールボックスの自動読取とインテリジェントトリアージの実装を記録します。

## デュアルメールボックスアーキテクチャ

- **Hotmail** — Microsoft Graph API経由
- **Gmail** — Gmail API経由

2つのAPI、2つの認証方式、完全に異なるエコシステム。

## MS Graph API：個人アカウントの罠

個人Microsoftアカウントは`/consumers/`エンドポイントが必須。`/common/`では動きません。曖昧な"invalid_grant"エラーで半日消費。

## Device Code Flow

ヘッドレスサーバーでブラウザなし。Device Code Flowで解決：プログラムがURLとコードを取得→AgentがTelegram経由で私に送信→スマホで認証完了→Agent がメール読取開始。

## Gmailリーダー

4つの機能：list（一覧）、unread（未読）、search（検索）、code（認証コード自動抽出）。認証コードメールから6桁を自動抽出し入力——手動コピー不要に。

## メールトリアージ：4段階自動分類

- **P0 緊急**：即時通知（キーワード+重要連絡先マッチ）
- **P1 重要**：当日処理（業務メール、請求書）→日次レポート
- **P2 普通**：週次まとめ（ニュースレター、SNS通知）
- **P3 低優先**：自動アーカイブ（マーケティング、プロモーション）

ルールベース分類（送信者ホワイトリスト+キーワード+ヘッダー分析）。高速・安定・予測可能。

## 運用効果

毎朝自動で2メールボックスの未読チェック→トリアージ→P0即時通知→P1日報。毎日50-80通から注目すべきは3-5通のみ。節約されるのは時間だけでなく注意力。

**認証が最も時間を消費する部分。** 実際のメール読取・分類ロジックはむしろ最もシンプル。
